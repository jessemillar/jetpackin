var l={globals:{dom:document.createElement("canvas"),room:{},zBuffer:[],camera:{state:"resting",x:0,y:0,previous:{x:0,y:0},sandbox:{width:1,height:1}}},lorina:function(){var a=this;this.setRoomSize=function(a,c){l.globals.room.width=a;l.globals.room.height=c;return this};this.setDomSize=function(a,c){l.globals.dom.width=a;l.globals.dom.height=c;return this};this.setDomSizeCSS=function(a,c){l.globals.dom.style.width=a;l.globals.dom.style.height=c;return this};this.setDomPosition=function(a,c){l.globals.dom.style.position=
"absolute";l.globals.dom.style.left=a+"px";l.globals.dom.style.top=c+"px";return this};this.setTitle=function(a){document.title=a;return this};this.scale=function(a){l.globals.dom.style["image-rendering"]="pixelated";this.scale=a;return this};this.makeFullscreen=function(){document.body.style.background=this.color;window.onresize=function(){a.setFullscreen()};this.setFullscreen();return this};this.setFullscreen=function(){a.setDomPosition(0,0);a.setDomSize(window.innerWidth/(this.scale/100),window.innerHeight/
(this.scale/100));a.setDomSizeCSS("100%","100%");a.setRoomSize(l.globals.dom.width,l.globals.dom.height)};this.appendCanvas=function(){document.body.appendChild(l.globals.dom);l.globals.ctx=l.globals.dom.getContext("2d")};this.hideCursor=function(){l.globals.dom.style.cursor="none";return this};this.setRoom=function(a){l.globals.room.current=a;window.requestAnimationFrame(a);return this};this.start=function(a){this.setRoom(a);return this};this.setColor=function(a){this.color=a;return this};this.blank=
function(a){l.globals.ctx.fillStyle=a?a:this.color;l.globals.ctx.fillRect(0,0,l.globals.dom.width,l.globals.dom.height);l.globals.zBuffer.length=0;return this};this.draw=function(){l.globals.zBuffer.sort(function(a,b){return a.y-b.y});for(var a=0;a<l.globals.zBuffer.length;a++)l.globals.zBuffer[a].draw();window.requestAnimationFrame(l.globals.room.current);return this}}};l.camera=function(){this.reset=function(){l.globals.camera.x=0;l.globals.camera.y=0;return this};this.setSandbox=function(a,b){l.globals.camera.sandbox.width=a;l.globals.camera.sandbox.height=b;0>=l.globals.camera.sandbox.width&&(l.globals.camera.sandbox.width=1);0>=l.globals.camera.sandbox.height&&(l.globals.camera.sandbox.height=1);return this};this.follow=function(a,b){var c,d;a.deleted||(b&&!b.deleted?(c=a.x<b.x?(b.x-a.x)/2+a.x:(a.x-b.x)/2+b.x,d=a.y<b.y?(b.y-a.y)/2+a.y:(a.y-b.y)/2+b.y):(c=a.x,
d=a.y),"resting"==l.globals.camera.state&&(l.globals.camera.sandbox.width&&(c<l.globals.camera.x+l.globals.dom.width/2-l.globals.camera.sandbox.width/2?l.globals.camera.x=c-l.globals.dom.width/2+l.globals.camera.sandbox.width/2:c>l.globals.camera.x+l.globals.dom.width/2+l.globals.camera.sandbox.width/2&&(l.globals.camera.x=c-l.globals.dom.width/2-l.globals.camera.sandbox.width/2)),l.globals.camera.sandbox.height&&(d<l.globals.camera.y+l.globals.dom.height/2-l.globals.camera.sandbox.height/2?l.globals.camera.y=
d-l.globals.dom.height/2+l.globals.camera.sandbox.height/2:d>l.globals.camera.y+l.globals.dom.height/2+l.globals.camera.sandbox.height/2&&(l.globals.camera.y=d-l.globals.dom.height/2-l.globals.camera.sandbox.height/2)),0>l.globals.camera.x?l.globals.camera.x=0:l.globals.camera.x>l.globals.room.width-l.globals.dom.width&&(l.globals.camera.x=l.globals.room.width-l.globals.dom.width),0>l.globals.camera.y?l.globals.camera.y=0:l.globals.camera.y>l.globals.room.height-l.globals.dom.height&&(l.globals.camera.y=
l.globals.room.height-l.globals.dom.height)));return this};this.focusOn=function(a,b){var c,d;b&&!b.deleted?(c=a.x<b.x?(b.x-a.x)/2+a.x:(a.x-b.x)/2+b.x,d=a.y<b.y?(b.y-a.y)/2+a.y:(a.y-b.y)/2+b.y):(c=a.x,d=a.y);l.globals.camera.x=c-l.globals.dom.width/2;l.globals.camera.y=d-l.globals.dom.height/2;l.mouse&&l.mouse.calculate();return this};this.shake=function(a,b,c){"resting"==l.globals.camera.state&&(l.globals.camera.previous.x=l.globals.camera.x,l.globals.camera.previous.y=l.globals.camera.y);l.globals.camera.state=
"shaking";c/=2*a;for(var d=0;d<2*a;d++)this.milkshake(d,c,b);return this};this.milkshake=function(a,b,c){setTimeout(function(){l.globals.camera.state="shaking";var a=0-c/2,b=c/2,f=Math.random()*(b-a)+a,a=Math.random()*(b-a)+a;l.globals.camera.x=0<f?l.globals.camera.x+f:l.globals.camera.x-Math.abs(f);l.globals.camera.y=0<a?l.globals.camera.y+a:l.globals.camera.y-Math.abs(a)},a*b);setTimeout(function(){l.globals.camera.state="resting";l.globals.camera.x=l.globals.camera.previous.x;l.globals.camera.y=
l.globals.camera.previous.y},a*b+b/2)}};l.cartographer=function(){this.setMap=function(a){a.tileset.img=new Image;a.tileset.img.onload=function(){a.tileset.width=this.width;a.tileset.height=this.height};a.tileset.img.src=a.tileset.image;return this};this.draw=function(a){for(var b=a.layout.tiles.length/a.layout.width;b--;)for(var c=a.layout.width;c--;)0<a.layout.tiles[b*a.layout.width+c]&&l.globals.ctx.drawImage(a.tileset.img,a.tileset.width/a.tileset.count*(a.layout.tiles[b*a.layout.width+c]-1),0,a.tileset.width/a.tileset.count,a.tileset.height,
a.tileset.width/a.tileset.count*c-l.globals.camera.x,b*a.tileset.height-l.globals.camera.y,a.tileset.width/a.tileset.count,a.tileset.height);return this}};l.cupboard=function(){this.save=function(a,b,c){b="object"==typeof b?JSON.stringify(b):b;c?sessionStorage.setItem(a,b):localStorage.setItem(a,b);return!0};this.get=function(a,b){if(b){if(sessionStorage.getItem(a))try{return JSON.parse(sessionStorage.getItem(a))}catch(c){return sessionStorage.getItem(a)}}else if(localStorage.getItem(a))try{return JSON.parse(localStorage.getItem(a))}catch(d){return localStorage.getItem(a)}};this.load=function(a,b,c){this.get(a,c)&&(b?b[a]=this.get(a,c):window[a]=this.get(a,
c))};this["delete"]=function(a,b){if(b){if(sessionStorage.getItem(a))return sessionStorage.removeItem(a),!0}else if(localStorage.getItem(a))return localStorage.removeItem(a),!0;return!1};this.clear=function(a){a?sessionStorage.clear():localStorage.clear();return!0}};l.entity=function(){this.rotation=0;this.stuck=!1;this.sprite={img:new Image};this.previous={x:0,y:0};this.anchor={x:0,y:0};this.bound={x:0,y:0,width:0,height:0};this.friction={x:0,y:0,movement:0,rotation:0};this.momentum={x:0,y:0,rotation:0};this.debug=function(a){this.deleted||(l.globals.ctx.fillStyle=a?a:"#FF0000",l.globals.ctx.globalAlpha=.5,l.globals.ctx.fillRect(this.x+this.bound.x-l.globals.camera.x,this.y+this.bound.y-l.globals.camera.y,this.bound.width,this.bound.height),l.globals.ctx.fillRect(this.x-
2-l.globals.camera.x,this.y-2-l.globals.camera.y,5,5),l.globals.ctx.globalAlpha=1);return this};this["delete"]=function(){this.deleted||(this.deleted=!0,this.freeze());return this};this.banish=function(a){this.deleted||(a||(a=300),(this.x<-a||this.x>l.globals.room.width+a||this.y<-a||this.y>l.globals.room.height+a)&&this["delete"]());return this};this.setTrait=function(a,b){this[a]=b;return this};this.deleteTrait=function(a){delete this[a];return this};this.setPosition=function(a,b){this.x=a;this.y=
b;return this};this.recordDifference=function(a,b){"horizontal"==a?this.previous.x=b:"vertical"==a&&(this.previous.y=b);return this};this.setAnchor=function(a,b){this.anchor={x:a,y:b};this.width&&this.height&&this.setBound(0-this.anchor.x,0-this.anchor.y,this.width,this.height);return this};this.setSize=function(a,b,c){this.width=a;this.height=b;c&&this.setBound(this.x,this.y,this.width,this.height);return this};this.setBound=function(a,b,c,d){this.bound={x:a,y:b,width:c,height:d};return this};this.rotate=
function(a){this.rotation+=a;this.fixRotation();return this};this.rotateTo=function(a){this.rotation=a;this.fixRotation();return this};this.fixRotation=function(){0>this.rotation?this.rotation+=360:360<this.rotation&&(this.rotation-=360);return this};this.steer=function(){this.rotation=180*-Math.atan(this.previous.y/this.previous.x)/Math.PI;0>this.previous.x&&(this.rotation+=180);return this};this.setSprite=function(a,b,c,d,e){var f=this;this.sprite.img.onload=function(){f.sprite.width=this.width;
f.sprite.height=this.height;if(b||void 0===b)d?f.setSize(this.width/d,this.height):f.setSize(this.width,this.height);if(c||void 0===c)d?f.setBound(0-f.anchor.x,0-f.anchor.y,this.width/d,this.height):f.setBound(0-f.anchor.x,0-f.anchor.y,this.width,this.height);d&&e&&(f.sprite.currentFrame=0,f.sprite.frameCount=d,f.sprite.timeBetweenFrames=Math.round(e),f.animation=setInterval(function(){f.sprite.currentFrame=f.sprite.currentFrame<f.sprite.frameCount-1?f.sprite.currentFrame+1:0},f.sprite.timeBetweenFrames))};
this.sprite.img.src=a;return this};this.pauseAnimation=function(){this.sprite.animation&&clearInterval(this.sprite.animation);return this};this.setOpacity=function(a){this.opacity=a;return this};this.fadeOut=function(a){this.opacity=0<this.opacity?this.opacity-a:0;return this};this.fadeIn=function(a){this.opacity=1>this.opacity?this.opacity+a:1;return this};this.buffer=function(){this.deleted||l.globals.zBuffer.push(this);return this};this.flip=function(a){this.flipped=a;return this};this.unflip=
function(){"horizontal"==this.flipped?"both"==this.flipped?this.flipped="vertical":delete this.flipped:"vertical"==this.flipped?"both"==this.flipped?this.flipped="vertical":delete this.flipped:"both"==this.flipped&&delete this.flipped;return this};this.hud=function(){this.drawMode="hud";return this};this.draw=function(){"hud"==this.drawMode?this.cameraY=this.cameraX=0:(this.cameraX=l.globals.camera.x,this.cameraY=l.globals.camera.y);this.deleted||(l.globals.ctx.globalAlpha=this.opacity,this.flipped||
this.rotation?(l.globals.ctx.save(),"undefined"!==this.flipped&&("horizontal"==this.flipped?(l.globals.ctx.translate(Math.round(this.x-2*this.anchor.x+this.width-this.cameraX),Math.round(this.y-this.cameraY)),l.globals.ctx.scale(-1,1)):"vertical"==this.flipped?(l.globals.ctx.translate(Math.round(this.x-this.cameraX),Math.round(this.y-2*this.anchor.y+this.height-this.cameraY)),l.globals.ctx.scale(1,-1)):"both"==this.flipped&&(l.globals.ctx.translate(Math.round(this.x-2*this.anchor.x+this.width-this.cameraX),
Math.round(this.y-2*this.anchor.y+this.height-this.cameraY)),l.globals.ctx.scale(-1,-1))),this.rotation&&(l.globals.ctx.translate(Math.round(this.x-this.cameraX),Math.round(this.y-this.cameraY)),l.globals.ctx.rotate(this.rotation*Math.PI/180*-1)),this.sprite.frameCount?l.globals.ctx.drawImage(this.sprite.img,this.sprite.width/this.sprite.frameCount*this.sprite.currentFrame,0,this.sprite.width/this.sprite.frameCount,this.sprite.height,Math.round(0-this.anchor.x),Math.round(0-this.anchor.y),this.sprite.width/
this.sprite.frameCount,this.sprite.height):l.globals.ctx.drawImage(this.sprite.img,Math.round(0-this.anchor.x),Math.round(0-this.anchor.y)),l.globals.ctx.restore()):this.sprite.frameCount?l.globals.ctx.drawImage(this.sprite.img,this.sprite.width/this.sprite.frameCount*this.sprite.currentFrame,0,this.sprite.width/this.sprite.frameCount,this.sprite.height,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY),this.sprite.width/this.sprite.frameCount,this.sprite.height):
l.globals.ctx.drawImage(this.sprite.img,Math.round(this.x-this.anchor.x-this.cameraX),Math.round(this.y-this.anchor.y-this.cameraY)));l.globals.ctx.globalAlpha=1;return this};this.snapTo=function(a,b){this.x=a;this.y=b;return this};this.moveHorizontal=function(a){this.recordDifference("horizontal",a);this.x+=a;return this};this.moveVertical=function(a){this.recordDifference("vertical",a);this.y+=a;return this};this.moveTo=function(a,b,c){a-=this.x;var d=b-this.y;b=Math.sqrt(a*a+d*d);d=d/b*c;1<b&&
(this.moveHorizontal(a/b*c),this.moveVertical(d));return this};this.moveToward=function(a,b){if(!a.deleted){var c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d),d=d/e*b;1<e&&(this.moveHorizontal(c/e*b),this.moveVertical(d))}return this};this.moveTowardDegree=function(a,b){this.moveHorizontal(Math.cos(a*Math.PI/180)*b);this.moveVertical(-Math.sin(a*Math.PI/180)*b);return this};this.contain=function(a,b,c,d){a||b||c||d||(a=0,b=l.globals.room.width,c=0,d=l.globals.room.height);this.x+this.bound.x<a?(this.momentum.x=
0,this.x=a-this.bound.x):this.x+this.bound.x+this.bound.width>b&&(this.momentum.x=0,this.x=b-this.bound.width-this.bound.x);this.y+this.bound.y<c?(this.momentum.y=0,this.y=c-this.bound.y):this.y+this.bound.y+this.bound.height>d&&(this.momentum.y=0,this.y=d-this.bound.height-this.bound.y);return this};this.stick=function(a,b,c,d){a||b||c||d||(a=0,b=l.globals.room.width,c=0,d=l.globals.room.height);this.x+this.bound.x<a?(this.freeze(),this.stuck=!0,this.x=a-this.bound.x):this.x+this.bound.x+this.bound.width>
b&&(this.freeze(),this.stuck=!0,this.x=b-this.bound.width-this.bound.x);this.y+this.bound.y<c?(this.freeze(),this.stuck=!0,this.y=c-this.bound.y):this.y+this.bound.y+this.bound.height>d&&(this.freeze(),this.stuck=!0,this.y=d-this.bound.height-this.bound.y);return this};this.setFriction=function(a,b){this.friction=b?{x:0,y:0,movement:a,rotation:b}:{x:0,y:0,movement:a,rotation:a};return this};this.setGravity=function(a){this.gravity=a;return this};this.freeze=function(){this.momentum={x:0,y:0,rotation:0};
this.momentum.rotation=0;return this};this.spin=function(a){this.momentum.rotation=a;return this};this.pushTowardDegree=function(a,b){this.momentum.x=Math.cos(a*Math.PI/180)*b;this.momentum.y=-Math.sin(a*Math.PI/180)*b;return this};this.pushHorizontal=function(a){this.momentum.x+=a;return this};this.pushVertical=function(a){this.momentum.y+=a;return this};this.scatter=function(a){this.momentum.x=Math.random()*(a- -1*a)+-1*a;this.momentum.y=Math.random()*(a- -1*a)+-1*a;return this};this.pullTo=function(a,
b,c){a-=this.x;var d=b-this.y;b=Math.sqrt(a*a+d*d);d=d/b*c;1<b&&(this.pushHorizontal(a/b*c),this.pushVertical(d));return this};this.pullToward=function(a,b){if(!a.deleted){var c=a.x-this.x,d=a.y-this.y,e=Math.sqrt(c*c+d*d),d=d/e*b;1<e&&(this.pushHorizontal(c/e*b),this.pushVertical(d))}return this};this.bounce=function(a,b,c,d){a||b||c||d||(a=0,b=l.globals.room.width,c=0,d=l.globals.room.height);this.x+this.bound.x<=a?(this.x=a-this.bound.x,this.momentum.x=-this.momentum.x):this.x+this.bound.x+this.bound.width>=
b&&(this.x=b-this.bound.width-this.bound.x,this.momentum.x=-this.momentum.x);this.y+this.bound.y<=c?(this.y=c-this.bound.y,this.momentum.y=-this.momentum.y):this.y+this.bound.y+this.bound.height>=d&&(this.y=d-this.bound.height-this.bound.y,this.momentum.y=-this.momentum.y);return this};this.applyPhysics=function(){if(!this.stuck){if(this.momentum.x||this.momentum.y)Math.abs(this.momentum.x)>Math.abs(this.momentum.y)?(this.friction.x=this.friction.movement,this.friction.y=Math.abs(this.momentum.y/
this.momentum.x*this.friction.movement)):(this.friction.x=Math.abs(this.momentum.x/this.momentum.y*this.friction.movement),this.friction.y=this.friction.movement);0!==this.momentum.x&&(this.moveHorizontal(this.momentum.x),0>this.momentum.x?(this.momentum.x+=this.friction.x,0<this.momentum.x&&(this.momentum.x=0)):0<this.momentum.x&&(this.momentum.x-=this.friction.x,0>this.momentum.x&&(this.momentum.x=0)));0!==this.momentum.y&&(this.moveVertical(this.momentum.y),0>this.momentum.y?(this.momentum.y+=
this.friction.y,0<this.momentum.y&&(this.momentum.y=0)):0<this.momentum.y&&(this.momentum.y-=this.friction.y,0>this.momentum.y&&(this.momentum.y=0)));0!==this.momentum.rotation&&(this.rotation+=this.momentum.rotation,0>this.momentum.rotation?(this.momentum.rotation+=this.friction.rotation,0<this.momentum.rotation&&(this.momentum.rotation=0)):0<this.momentum.rotation&&(this.momentum.rotation-=this.friction.rotation,0>this.momentum.rotation&&(this.momentum.rotation=0)));this.y+this.bound.height<l.globals.room.height&&
this.pushVertical(this.gravity);return this}}};l.finger=function(){this.touching=!1;this.y=this.x=void 0;this.database=[];var a=this;l.globals.dom.addEventListener("touchstart",function(b){a.touches(b)},!1);l.globals.dom.addEventListener("touchmove",function(b){a.touches(b)},!1);l.globals.dom.addEventListener("touchend",function(){a.clearTouches()},!1);l.globals.dom.addEventListener("touchcancel",function(){a.clearTouches()},!1);this.touches=function(a){this.touching=!0;this.x=a.touches[0].clientX;this.y=a.touches[0].clientY;this.database=a.touches};
this.clearTouches=function(){this.touching=!1;this.y=this.x=void 0;this.database.length=0};this.checkTouched=function(a){if(0<this.database.length)for(var c=this.database.length;c--;){if(this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y)return!0;if(c==this.database.length-1)return!1}}};l.gamepad=function(){this.deadzone=0;this.update=function(){var a;l.globals.gamepads=navigator.webkitGetGamepads();if(a=l.globals.gamepads[0])this.p1={buttons:{playstation:a.buttons[16],x:a.buttons[0],circle:a.buttons[1],square:a.buttons[2],triangle:a.buttons[3],l1:a.buttons[4],l2:a.buttons[6],r1:a.buttons[5],r2:a.buttons[7],select:a.buttons[8],start:a.buttons[9],up:a.buttons[12],down:a.buttons[13]},left:a.buttons[14],right:a.buttons[15],joysticks:{left:{horizontal:a.axes[0],vertical:a.axes[1],button:a.buttons[10]},
right:{horizontal:a.axes[2],vertical:a.axes[3],button:a.buttons[11]}}};if(a=l.globals.gamepads[1])this.p2={buttons:{playstation:a.buttons[16],x:a.buttons[0],circle:a.buttons[1],square:a.buttons[2],triangle:a.buttons[3],l1:a.buttons[4],l2:a.buttons[6],r1:a.buttons[5],r2:a.buttons[7],select:a.buttons[8],start:a.buttons[9],up:a.buttons[12],down:a.buttons[13]},left:a.buttons[14],right:a.buttons[15],joysticks:{left:{horizontal:a.axes[0],vertical:a.axes[1],button:a.buttons[10]},right:{horizontal:a.axes[2],
vertical:a.axes[3],button:a.buttons[11]}}};this.applyDeadzone();return this};this.setDeadzone=function(a){this.deadzone=a;return this};this.applyDeadzone=function(){0<this.deadzone&&(this.p1&&(Math.abs(gamepads.p1.joysticks.left.horizontal)<this.deadzone&&(gamepads.p1.joysticks.left.horizontal=0),Math.abs(gamepads.p1.joysticks.left.vertical)<this.deadzone&&(gamepads.p1.joysticks.left.vertical=0),Math.abs(gamepads.p1.joysticks.right.horizontal)<this.deadzone&&(gamepads.p1.joysticks.right.horizontal=
0),Math.abs(gamepads.p1.joysticks.right.vertical)<this.deadzone&&(gamepads.p1.joysticks.right.vertical=0)),this.p2&&(Math.abs(gamepads.p2.joysticks.left.horizontal)<this.deadzone&&(gamepads.p2.joysticks.left.horizontal=0),Math.abs(gamepads.p2.joysticks.left.vertical)<this.deadzone&&(gamepads.p2.joysticks.left.vertical=0),Math.abs(gamepads.p2.joysticks.right.horizontal)<this.deadzone&&(gamepads.p2.joysticks.right.horizontal=0),Math.abs(gamepads.p2.joysticks.right.vertical)<this.deadzone&&(gamepads.p2.joysticks.right.vertical=
0)))}};l.group=function(){this.database=[];this.add=function(a){this.database.push(a)};this.remove=function(a){for(var b=this.database.length;b--;)if(this.database[b]==a){this.database.splice(b,1);break}};this.debug=function(a){for(var b=this.database.length;b--;)this.database[b].debug(a);return this};this["delete"]=function(){for(var a=this.database.length;a--;)this.database[a]["delete"]();return this};this.banish=function(){for(var a=this.database.length;a--;)this.database[a].banish();return this};this.setTrait=
function(a,b){for(var c=this.database.length;c--;)this.database[c].setTrait(a,b);return this};this.deleteTrait=function(a){for(var b=this.database.length;b--;)this.database[b].deleteTrait(a);return this};this.setPosition=function(a,b){for(var c=this.database.length;c--;)this.database[c].setPosition(a,b);return this};this.setAnchor=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnchor(a,b);return this};this.setSize=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].setSize(a,
b,c);return this};this.setBound=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].setbound(a,b,c,d);return this};this.rotate=function(a){for(var b=this.database.length;b--;)this.database[b].rotate(a);return this};this.rotateTo=function(a){for(var b=this.database.length;b--;)this.database[b].rotateTo(a);return this};this.steer=function(){for(var a=this.database.length;a--;)this.database[a].steer();return this};this.setSprite=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].setSprite(a,
b,c);return this};this.setAnimation=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnimation(a,b);return this};this.pauseAnimation=function(){for(var a=this.database.length;a--;)this.database[a].pauseAnimation();return this};this.setOpacity=function(a){for(var b=this.database.length;b--;)this.database[b].setOpacity(a);return this};this.fadeOut=function(a){for(var b=this.database.length;b--;)this.database[b].fadeOut(a);return this};this.fadeIn=function(a){for(var b=this.database.length;b--;)this.database[b].fadeIn(a);
return this};this.buffer=function(){for(var a=this.database.length;a--;)this.database[a].buffer();return this};this.flip=function(a){for(var b=this.database.length;b--;)this.database[b].flip(a);return this};this.unflip=function(){for(var a=this.database.length;a--;)this.database[a].unflip();return this};this.hud=function(){for(var a=this.database.length;a--;)this.database[a].hud();return this};this.draw=function(){for(var a=this.database.length;a--;)this.database[a].deleted?this.database.splice(a,
1):this.database[a].draw();return this};this.snapTo=function(a,b){for(var c=this.database.length;c--;)this.database[c].snapTo(a,b);return this};this.moveHorizontal=function(a){for(var b=this.database.length;b--;)this.database[b].moveHorizontal(a);return this};this.moveVertical=function(a){for(var b=this.database.length;b--;)this.database[b].moveVertical(a);return this};this.moveTo=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].moveTo(a,b,c);return this};this.moveToward=function(a,
b){for(var c=this.database.length;c--;)this.database[c].moveToward(a,b);return this};this.moveTowardDegree=function(a,b){for(var c=this.database.length;c--;)this.database[c].moveTowardDegree(a,b);return this};this.contain=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].contain(a,b,c,d);return this};this.stick=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].stick(a,b,c,d);return this};this.setFriction=function(a){for(var b=this.database.length;b--;)this.database[b].setFriction(a);
return this};this.setGravity=function(a){for(var b=this.database.length;b--;)this.database[b].setGravity(a);return this};this.freeze=function(){for(var a=this.database.length;a--;)this.database[a].freeze();return this};this.spin=function(a){for(var b=this.database.length;b--;)this.database[b].spin(a);return this};this.pushHorizontal=function(a){for(var b=this.database.length;b--;)this.database[b].pushHorizontal(a);return this};this.pushVertical=function(a){for(var b=this.database.length;b--;)this.database[b].pushVertical(a);
return this};this.scatter=function(a){for(var b=this.database.length;b--;)this.database[b].scatter(a);return this};this.pullTo=function(a,b,c){for(var d=this.database.length;d--;)this.database[d].pullTo(a,b,c);return this};this.pullToward=function(a,b){for(var c=this.database.length;c--;)this.database[c].pullToward(a,b);return this};this.bounce=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].bounce(a,b,c,d);return this};this.applyPhysics=function(){for(var a=this.database.length;a--;)this.database[a].applyPhysics();
return this}};l.keyboard=function(){var a=this;window.onkeydown=function(){a.pressed(event)};window.onkeyup=function(){a.cancel(event)};this.pressed=function(a){27==a.keyCode&&(this.escape=!0);32==a.keyCode&&(this.space=!0);13==a.keyCode&&(this.enter=!0);16==a.keyCode&&(this.shift=!0);87==a.keyCode&&(this.w=!0);65==a.keyCode&&(this.a=!0);83==a.keyCode&&(this.s=!0);68==a.keyCode&&(this.d=!0);38==a.keyCode&&(this.up=!0);40==a.keyCode&&(this.down=!0);37==a.keyCode&&(this.left=!0);39==a.keyCode&&(this.right=!0)};this.cancel=
function(a){27==a.keyCode&&(this.escape=!1);32==a.keyCode&&(this.space=!1);13==a.keyCode&&(this.enter=!1);16==a.keyCode&&(this.shift=!1);87==a.keyCode&&(this.w=!1);65==a.keyCode&&(this.a=!1);83==a.keyCode&&(this.s=!1);68==a.keyCode&&(this.d=!1);38==a.keyCode&&(this.up=!1);40==a.keyCode&&(this.down=!1);37==a.keyCode&&(this.left=!1);39==a.keyCode&&(this.right=!1)}};l.mouse=function(){var a=this;document.onmouseout=function(){a.mouseOut()};document.onmousemove=function(){a.update()};l.globals.dom.onmousedown=function(){a.clicked()};l.globals.dom.oncontextmenu=function(){event.preventDefault()};l.globals.dom.onmouseup=function(){a.cancel()};this.update=function(){this.actualX=event.clientX-l.globals.dom.offsetLeft;this.actualY=event.clientY-l.globals.dom.offsetTop;this.calculate()};this.calculate=function(){this.x=this.actualX+l.globals.camera.x;this.y=this.actualY+
l.globals.camera.y};this.mouseOut=function(){this.y=this.x=null};this.clicked=function(){1==event.which?this.leftClick=!0:2==event.which?this.middleClick=!0:3==event.which&&(this.rightClick=!0,event.preventDefault())};this.checkLeftClicked=function(a){return this.leftClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};var b=void 0,c=void 0,d=!1;this.checkDrag=function(a){this.checkLeftClicked(a)?d=!0:mouse.leftClick||(c=
b=void 0,d=!1);d&&(b&&c&&(a.x=mouse.x-b,a.y=mouse.y-c),b||c||(b=mouse.x-a.x,c=mouse.y-a.y));return this};this.checkMiddleClicked=function(a){return this.middleClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};this.checkRightClicked=function(a){return this.rightClick&&this.x<a.x+a.bound.x+a.bound.width&&this.x>a.x+a.bound.x&&this.y<a.y+a.bound.y+a.bound.height&&this.y>a.y+a.bound.y?!0:!1};this.cancel=function(){1==event.which?
this.leftClick=!1:2==event.which?this.middleClick=!1:3==event.which&&(this.rightClick=!1,event.preventDefault())}};l.pencil=function(){this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.setEndPosition=function(a,b){this.endX=a;this.endY=b;return this};this.setSize=function(a,b){this.width=a;this.height=b;return this};this.setRadius=function(a){this.radius=a;return this};this.setColor=function(a){this.color=a;return this};this.setOpacity=function(a){this.opacity=a;return this};this.setStroke=function(a){this.stroke=a;return this};this.setArc=function(a,b){this.start=a;this.stop=b;return this};this.strokeLine=
function(){l.globals.ctx.strokeStyle=this.color;l.globals.ctx.lineWidth=this.stroke;l.globals.ctx.beginPath();l.globals.ctx.moveTo(Math.round(this.x)+.5,Math.round(this.y)+.5);l.globals.ctx.lineTo(Math.round(this.endX)+.5,Math.round(this.endY)+.5);this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.stroke();this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.strokeCircle=function(){l.globals.ctx.strokeStyle=this.color;l.globals.ctx.lineWidth=this.stroke;l.globals.ctx.beginPath();
l.globals.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*Math.PI);this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.stroke();this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.fillCircle=function(){l.globals.ctx.fillStyle=this.color;l.globals.ctx.beginPath();l.globals.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,0,2*Math.PI);this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.fill();this.opacity=1;l.globals.ctx.globalAlpha=
1;return this};this.strokeArc=function(){l.globals.ctx.strokeStyle=this.color;l.globals.ctx.lineWidth=this.stroke;l.globals.ctx.beginPath();l.globals.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,this.start*Math.PI/180,this.stop*Math.PI/180);this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.stroke();this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.fillArc=function(){l.globals.ctx.fillStyle=this.color;l.globals.ctx.beginPath();l.globals.ctx.arc(Math.round(this.x),
Math.round(this.y),this.radius,this.start*Math.PI/180,this.stop*Math.PI/180);this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.fill();this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.strokeRectangle=function(){l.globals.ctx.strokeStyle=this.color;l.globals.ctx.lineWidth=this.stroke;l.globals.ctx.beginPath();l.globals.ctx.rect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height));this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.stroke();
this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.fillRectangle=function(){l.globals.ctx.fillStyle=this.color;l.globals.ctx.beginPath();l.globals.ctx.rect(Math.round(this.x),Math.round(this.y),Math.round(this.width),Math.round(this.height));this.opacity&&(l.globals.ctx.globalAlpha=this.opacity);l.globals.ctx.fill();this.opacity=1;l.globals.ctx.globalAlpha=1;return this};this.fillPie=function(a){100>Math.round(a)?(a=270+3.6*a,360<a&&(a-=360),l.globals.ctx.fillStyle=this.color,l.globals.ctx.beginPath(),
l.globals.ctx.moveTo(Math.round(this.x),Math.round(this.y)),l.globals.ctx.arc(Math.round(this.x),Math.round(this.y),this.radius,270*Math.PI/180,a*Math.PI/180),l.globals.ctx.lineTo(Math.round(this.x),Math.round(this.y)),this.opacity&&(l.globals.ctx.globalAlpha=this.opacity),l.globals.ctx.fill(),this.opacity=1,l.globals.ctx.globalAlpha=1):this.fillCircle();return this}};l.scissors=function(){this.mark=function(a,b,c,d){l.globals.ctx.save();l.globals.ctx.beginPath();l.globals.ctx.rect(a,b,c,d);l.globals.ctx.clip();return this};this.cut=function(){l.globals.ctx.restore();return this}};l.speaker=function(){var a=[],b=[];this.load=function(b,d){var e;window.cordova?(e=new Media(d),e.name=b,this.cordovaLoad(e)):(e=new Audio,e.name=b,e.src=d,e.preload="auto");a.push(e);return this};this.pause=function(b){for(var d=a.length;d--;)if(a[d].name==b){a[d].pause();break}return this};this.play=function(c){for(var d=a.length;d--;)if(a[d].name==c){window.cordova?(c=new Media(a[d].src),c.name=a[d].name,b.push(c),b[b.length-1].play({playAudioWhenScreenIsLocked:!1})):(b.push(a[d].cloneNode()),
b[b.length-1].play(),b[b.length-1].addEventListener("ended",this.removeAudio(b.length-1)));break}return this};this.removeAudio=function(a){b.splice(a,1)}};l.timer=function(){this.start=function(){this.time=Date.parse(new Date);return this};this.clear=function(){this.time=void 0;return this};this.check=function(){return this.time?Date.parse(new Date)-this.time:0};this.compareTo=function(a){return a.time?a=this.time>a.time?this.time-a.time:a.time-this.time:0}};l.tool=function(){this.random=function(a,b){return Math.random()*(b-a)+a};this.measureX=function(a,b){return Math.abs(a.x-b.x)};this.measureY=function(a,b){return Math.abs(a.y-b.y)};this.measureDistance=function(a,b){var c=this.measureX(a,b),d=this.measureY(a,b);return Math.sqrt(c*c+d*d)};this.measureAngle=function(a,b){var c=b.x-a.x,d=a.y-b.y,e=180*Math.atan(d/c)/Math.PI;0>c?e+=180:0<c&&0>d&&(e+=360);return e};this.sin=function(a){return Math.sin(a/180*Math.PI)*(180/Math.PI)};this.cos=function(a){return Math.cos(a/
180*Math.PI)*(180/Math.PI)};this.tan=function(a){return Math.tan(a/180*Math.PI)*(180/Math.PI)};this.checkSolid=function(a,b){var c=this.checkCollision(a,b);c&&(a.previous.y+a.bound.y+a.bound.height<=c.y+c.bound.y?a.y=c.y+c.bound.y-(a.bound.height+a.bound.y):a.previous.y+a.bound.y>=c.y+c.bound.y+c.bound.height?a.y=c.y+c.bound.y+c.bound.height-a.bound.y:a.previous.x+a.bound.x+a.bound.width<c.x?a.x=c.x+c.bound.x-(a.bound.width+a.bound.x):a.previous.x+a.bound.x>c.x&&(a.x=c.x+c.bound.x+c.bound.width-a.bound.x));
return this};this.checkCollision=function(a,b){if(a.deleted)return!1;if(b.database){for(var c=b.database.length;c--;)if(!b.database[c].deleted&&a.x+a.bound.x<b.database[c].x+b.database[c].bound.x+b.database[c].bound.width&&a.x+a.bound.x+a.bound.width>b.database[c].x+b.database[c].bound.x&&a.y+a.bound.y<b.database[c].y+b.database[c].bound.y+b.database[c].bound.height&&a.y+a.bound.y+a.bound.height>b.database[c].y+b.database[c].bound.y)return b.database[c];return!1}return a.x+a.bound.x<b.x+b.bound.x+
b.bound.width&&a.x+a.bound.x+a.bound.width>b.x+b.bound.x&&a.y+a.bound.y<b.y+b.bound.y+b.bound.height&&a.y+a.bound.y+a.bound.height>b.y+b.bound.y?b:!1}};l.typewriter=function(){this.reset=function(){this.textMode=this.color=this.size=this.font=this.style=this.opacity=this.baseline=this.alignment=void 0;return this};this.setOpacity=function(a){this.opacity=a;return this};this.setStyle=function(a){this.style=a;return this};this.setFont=function(a){this.font=a;return this};this.setSize=function(a){this.size=a;return this};this.setAlignment=function(a){this.alignment=a;return this};this.setBaseline=function(a){this.baseline=a;return this};this.setColor=
function(a){this.color=a;return this};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.write=function(a,b){l.globals.ctx.font=(this.style?this.style:"")+" "+this.size+"px "+(this.font?this.font:"sans-serif");l.globals.ctx.fillStyle=this.color?this.color:"#000000";l.globals.ctx.textAlign=this.alignment?this.alignment:"left";l.globals.ctx.textBaseline="top"==this.baseline?"hanging":"middle"==this.baseline?"middle":"bottom"==this.baseline?"alphabetic":"hanging";this.opacity&&(l.globals.ctx.globalAlpha=
this.opacity,this.opacity=1);b?l.globals.ctx.fillText(a,this.x,this.y):l.globals.ctx.fillText(a,this.x-l.globals.camera.x,this.y-l.globals.camera.y);l.globals.ctx.globalAlpha=1;return this};var a=!1,b=0;this.type=function(c,d){a||(this.key(c,d),a=!0);this.write(c.substr(0,b));return this};this.key=function(a,d){for(var e=0;e<a.length;e++)setTimeout(function(){b++},d*e)}};